<!doctype html>
<html>
<head>
    <title>IComeFromTheNet.com &mdash; Released Doctrine DBAL Table Gateway</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="description" content="where I come from." />
    <meta name="author" content="Lewis Dyer" />
    <meta name="generator" content="PieCrust 0.9.0-dev" />
    <meta name="template-engine" content="Twig" />
    
    <link href="/css/monokai.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />
   
    <script type="text/javascript" src="http://use.typekit.com/oqv4wfc.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    <script src="/js/highlight.pack.js"></script>
</head>
<body>
    <div id="container" class="container">
        <div class="nav">
	    <a href="/">Home</a>
	    <a href="/blog.html">Blog</a>
	    <a href="/projects.html">Projects</a>
	    <a href="/favourite/index.html">What I Like</a>
	    <a href="/bookshelf.html">Bookshelf</a>
        </div>

	            <h1>Released Doctrine DBAL Table Gateway</h1>

        <div id="main" class="main">
            <div class="content">
                	<h2>Released Doctrine DBAL Table Gateway</h2>
	<div class="post-meta">
		<span class="post-date">November 5, 2012</span>
						& Tags:
		<span class="post-tags">
						<a href="/tag/php.html">php</a>, 						<a href="/tag/doctrine.html">doctrine</a>					</span>
	
	</div>
	<p>I released a new library today <a href="https://github.com/icomefromthenet/DBALGateway">DBALGateway</a>. <a href="http://www.doctrine-project.org/projects/dbal.html">Doctrine DBAL</a> is a fantastic extension to PDO with a little more abstraction it becomes easer to use. This component implements <a href="http://martinfowler.com/eaaCatalog/tableDataGateway.html">Table Gateway</a> on top of Doctrine DBAL. This component is heavily inspired by zf2 Table Gateway and can be applied where there is a 1 to 1 mapping of your database to entities.</p>

<!--more-->

<h2>What are the benefits?</h2>

<ol>
<li><p>Using metadata the gateway will convert values, for example DateTime is converted to a stamps and the stamp is converted back to DateTime. </p></li>
<li><p>Events system, e.g pre<em>select , post</em>delete , pre_insert&#8230; based around the symfony2 event dispatcher.</p></li>
<li><p>Query Logger using Monolog, you would normally write this yourself.</p></li>
<li><p>Builder can map records to entities, you could build an active record on top of this gateway.</p></li>
<li><p>Supply a collection class and it will load them into it.</p></li>
<li><p>Fluid interface for running selects, inserts, updates and deletes.</p></li>
</ol>

<h2>Whats are the cons?</h2>

<ol>
<li>Loose auto-completion in your IDE, for subclasses, only get it for the bases classes.</li>
<li>Overhead a little more memory and extra method calls.  </li>
</ol>

<h2>Install</h2>

<p>This component can be installed via composer.</p>

<pre class="json" style="font-family:monospace;">{
    &quot;require&quot; : {
        &quot;icomefromthenet/dbal-gateway&quot; : &quot;dev-master&quot;,
    }
&nbsp;
}
&nbsp;</pre>

<h2>Usage.</h2>

<p>There are 3 components to every table:</p>

<ol>
<li>Metadata instanceof <code>DBALGateway\Metadata\Table</code>.</li>
<li>Subclass of <code>DBALGateway\Table\AbstractTable</code> the gateway.</li>
<li>Subclass of <code>DBALGateway\Query\AbstractQuery</code> the query class.</li>
</ol>

<p>There are 2 optional components to every table:</p>

<ol>
<li>Custom result-set implementation of <code>Doctrine\Common\Collections\Collection</code>.</li>
<li>Entity builder implementation of <code>DBALGateway\Builder\BuilderInterface</code>.</li>
</ol>

<h3>1. The Metadata</h3>

<p>Assume have the following databse table.</p>

<pre class="sql" style="font-family:monospace;">delimiter $$
&nbsp;
<span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #ff0000;">`users`</span> <span style="color: #66cc66;">&#40;</span>
  <span style="color: #ff0000;">`id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">10</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">UNSIGNED</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`username`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">32</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">COLLATE</span> utf8_unicode_ci <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`first_name`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">45</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">COLLATE</span> utf8_unicode_ci <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`last_name`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">&#40;</span><span style="color: #cc66cc;">45</span><span style="color: #66cc66;">&#41;</span> <span style="color: #993333; font-weight: bold;">COLLATE</span> utf8_unicode_ci <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`dte_created`</span> datetime <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`dte_updated`</span> datetime <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">PRIMARY</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">&#40;</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">&#41;</span>
<span style="color: #66cc66;">&#41;</span> ENGINE<span style="color: #66cc66;">=</span>InnoDB <span style="color: #993333; font-weight: bold;">DEFAULT</span> CHARSET<span style="color: #66cc66;">=</span>utf8 <span style="color: #993333; font-weight: bold;">COLLATE</span><span style="color: #66cc66;">=</span>utf8_unicode_ci$$
&nbsp;
&nbsp;</pre>

<p>You can declare the metadata as follows.</p>

<pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<span style="color: #000000; font-weight: bold;">namespace</span> ExampleFile
&nbsp;
<span style="color: #000000; font-weight: bold;">use</span> DBALGateway\Metadata\Table<span style="color: #339933;">;</span>
&nbsp;
<a href="http://www.php.net/call_user_func"><span style="color: #990000;">call_user_func</span></a><span style="color: #009900;">&#40;</span><span style="color: #000000; font-weight: bold;">function</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;"># create the table object
</span>    <span style="color: #000088;">$table</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> Table<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;"># assign normal columns 
</span>    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'id'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;integer&quot;</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;unsigned&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #009900; font-weight: bold;">true</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'username'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;string&quot;</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;length&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #cc66cc;">32</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'first_name'</span><span style="color: #339933;">,</span> <span style="color: #0000ff;">&quot;string&quot;</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;length&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #cc66cc;">45</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'last_name'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;string&quot;</span><span style="color: #339933;">,</span> <a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;length&quot;</span> <span style="color: #339933;">=&gt;</span> <span style="color: #cc66cc;">45</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_created'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'datetime'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_updated'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'datetime'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setPrimaryKey</span><span style="color: #009900;">&#40;</span><a href="http://www.php.net/array"><span style="color: #990000;">array</span></a><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">&quot;id&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #666666; font-style: italic;"># assign virtual columns, these are perfect for calulated values.
</span>    <span style="color: #666666; font-style: italic;"># these columns can not be inserted but will be converted if found in a result-set.
</span>    <span style="color: #000088;">$table</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">addVirtualColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'uptime'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">&quot;datetime&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #b1b100;">return</span> <span style="color: #000088;">$table</span><span style="color: #339933;">;</span>    
<span style="color: #009900;">&#125;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;</pre>

<p>The datatypes (second argument in addColumn) are <strong>not mysql types</strong> but <strong>doctrine types</strong>, the mapping can be found under <code>Doctrine\DBAL\Platforms\{MYPLATFORM}</code>.</p>

<h3>2. The Table Gateway.</h3>

<p>You will need to declare a subclass of <code>DBALGateway\Metadata\Table</code> and override the method <code>newQueryObject()</code>.</p>

<pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<span style="color: #000000; font-weight: bold;">namespace</span> DBALGateway\Tests\Base\Mock<span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">use</span> DBALGateway\Table\AbstractTable<span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">class</span> MockUserTableGateway <span style="color: #000000; font-weight: bold;">extends</span> AbstractTable
<span style="color: #009900;">&#123;</span>
    <span style="color: #009933; font-style: italic;">/**
      *  Create a new instance of the querybuilder
      *
      *  @access public
      *  @return QueryBuilder
      */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> newQueryBuilder<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #b1b100;">return</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserQuery<span style="color: #009900;">&#40;</span><span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">adapter</span><span style="color: #339933;">,</span><span style="color: #000088;">$this</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;</pre>

<p>You may also include other custom code on this class. But note all methods a marked as <code>protected</code> be careful with naming.</p>

<h3>3. The QueryClass</h3>

<p>You will need to subclass <code>DBALGateway\Query\AbstractQuery</code> which is itself a subclass of <code>Doctrine\DBAL\Query\QueryBuilder</code>.</p>

<pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">&lt;?php</span>
<span style="color: #000000; font-weight: bold;">namespace</span> DBALGateway\Tests\Base\Mock<span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">use</span> DBALGateway\Query\AbstractQuery<span style="color: #339933;">;</span>
<span style="color: #000000; font-weight: bold;">use</span> DateTime<span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">class</span> MockUserQuery <span style="color: #000000; font-weight: bold;">extends</span> AbstractQuery
<span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> filterByUser<span style="color: #009900;">&#40;</span><span style="color: #000088;">$id</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">where</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'id = :id'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setParameter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'id'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$id</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getGateway</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getMetaData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><a href="http://www.php.net/gettype"><span style="color: #990000;">getType</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> filterByUsername<span style="color: #009900;">&#40;</span><span style="color: #000088;">$name</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">where</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'username = :username'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setParameter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'username'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$id</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getGateway</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getMetaData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'username'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><a href="http://www.php.net/gettype"><span style="color: #990000;">getType</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> filterByDateCreated<span style="color: #009900;">&#40;</span>DateTime <span style="color: #000088;">$created</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">where</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_created = :dte_created'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setParameter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_created'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$id</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getGateway</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getMetaData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_created'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><a href="http://www.php.net/gettype"><span style="color: #990000;">getType</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> filterByDateUpdated<span style="color: #009900;">&#40;</span>DateTime <span style="color: #000088;">$updated</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">where</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_updated = :dte_updated'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">setParameter</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_updated'</span><span style="color: #339933;">,</span> <span style="color: #000088;">$id</span><span style="color: #339933;">,</span> <span style="color: #000088;">$this</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getGateway</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getMetaData</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">getColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_updated'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span><a href="http://www.php.net/gettype"><span style="color: #990000;">getType</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$this</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;</pre>

<p><strong>Each custom filter should do the following.</strong></p>

<ol>
<li>Set a unique named parameter.</li>
<li>Set the parameter value and fetch the doctrine type from the meta-data in the table gateway.</li>
<li>Return $this.</li>
</ol>

<h3>4. The Collections class.</h3>

<p>When using <code>find()</code> on the gateway results will be stored in a collection class offerd by doctrine <code>Doctrine\Common\Collections\ArrayCollection</code>. If the gateway&#8217;s constructor is passed an instance an alternative that inherits the interface from <code>Doctrine\Common\Collections\Collection</code> it will clone a copy and use that.</p>

<pre class="php" style="font-family:monospace;">&nbsp;
<span style="color: #000000; font-weight: bold;">use</span> Doctrine\Common\Collections\Collection<span style="color: #339933;">;</span>
&nbsp;
&nbsp;
<span style="color: #000000; font-weight: bold;">class</span> CustomCollection implements Collection
<span style="color: #009900;">&#123;</span>
 <span style="color: #339933;">.....</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000088;">$collection</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> CustomCollection<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$gateway</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'user'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #339933;">,</span><span style="color: #000088;">$collection</span><span style="color: #339933;">,</span><span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;</pre>

<p>This gateway will clone <code>$collection</code> on each call to <code>find</code>. <strong>Note:</strong> <code>findOne()</code> does not return collection just entity/array.</p>

<h3>5. The Entity Builder</h3>

<p>When using <code>find()</code> or <code>findOne()</code> each result found in the set will be passed to the builder for conversion into an entity. A builder must implement the interface found at <code>DBALGateway\Builder\BuilderInterface</code>.</p>

<pre class="php" style="font-family:monospace;"><span style="color: #000000; font-weight: bold;">use</span> DBALGateway\Builder\BuilderInterface<span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000000; font-weight: bold;">class</span> EntityBuilder implements BuilderInterface
<span style="color: #009900;">&#123;</span>
     <span style="color: #009933; font-style: italic;">/**
      *  Convert data array into entity
      *
      *  @return mixed
      *  @param array $data
      *  @access public
      */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> build<span style="color: #009900;">&#40;</span><span style="color: #000088;">$data</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
        <span style="color: #000088;">$user</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> UserEntity<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #000088;">$user</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">id</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
        <span style="color: #000088;">$user</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">username</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$data</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'username'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
        <span style="color: #339933;">...</span> etc
&nbsp;
        <span style="color: #b1b100;">return</span> <span style="color: #000088;">$user</span><span style="color: #339933;">;</span>
&nbsp;
    <span style="color: #009900;">&#125;</span>
&nbsp;
    <span style="color: #009933; font-style: italic;">/**
      *  Convert and entity into a data array
      *
      *  @return array
      *  @access public
      */</span>
    <span style="color: #000000; font-weight: bold;">public</span> <span style="color: #000000; font-weight: bold;">function</span> demolish<span style="color: #009900;">&#40;</span><span style="color: #000088;">$entity</span><span style="color: #009900;">&#41;</span>
    <span style="color: #009900;">&#123;</span>
&nbsp;
    <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #000088;">$builder</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> EntityBuilder<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000088;">$gateway</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #339933;">,</span><span style="color: #009900; font-weight: bold;">null</span><span style="color: #339933;">,</span><span style="color: #000088;">$builder</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;</pre>

<p><strong>Note:</strong> If a collection class is used this new entity will be given to the collection.</p>

<h2>Running Queries</h2>

<h3>Run an INSERT Query.</h3>

<pre class="php" style="font-family:monospace;"><span style="color: #000088;">$gateway</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$success</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$gateway</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">insertQuery</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><span style="color: #004000;">start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'username'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'ausername'</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'first_name'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'myfname'</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'last_name'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'mylname'</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_created'</span><span style="color: #339933;">,</span><span style="color: #000000; font-weight: bold;">new</span> DateTime<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_updated'</span><span style="color: #339933;">,</span>DateTime<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><a href="http://www.php.net/end"><span style="color: #990000;">end</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
           <span style="color: #339933;">-&gt;</span><span style="color: #004000;">insert</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$success</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
 <span style="color: #000088;">$id</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$gateway</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">lastInsertId</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;</pre>

<h3>Run an UPDATE Query.</h3>

<pre class="php" style="font-family:monospace;"><span style="color: #000088;">$gateway</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$success</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$gateway</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">updateQuery</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><span style="color: #004000;">start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'username'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'ausername'</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'first_name'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'myfname'</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'last_name'</span><span style="color: #339933;">,</span><span style="color: #0000ff;">'mylname'</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_created'</span><span style="color: #339933;">,</span><span style="color: #000000; font-weight: bold;">new</span> DateTime<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">addColumn</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'dte_updated'</span><span style="color: #339933;">,</span>DateTime<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><span style="color: #004000;">where</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">filterByUser</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">101</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><a href="http://www.php.net/end"><span style="color: #990000;">end</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
           <span style="color: #339933;">-&gt;</span><span style="color: #004000;">update</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$success</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
 <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'table row was updated'</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;</pre>

<h3>Run a DELETE Query.</h3>

<pre class="php" style="font-family:monospace;"><span style="color: #000088;">$gateway</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$success</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$gateway</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">deleteQuery</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><span style="color: #004000;">start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">filterByUser</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><a href="http://www.php.net/end"><span style="color: #990000;">end</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
           <span style="color: #339933;">-&gt;</span><span style="color: #004000;">delete</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$success</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
&nbsp;
 <span style="color: #b1b100;">echo</span> <span style="color: #0000ff;">'table row was removed'</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;</pre>

<h3>Run a SELECT Query.</h3>

<p>There are two methods <code>findOne()</code> and <code>find()</code>.</p>

<pre class="php" style="font-family:monospace;"><span style="color: #000088;">$gateway</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$gateway</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">selectQuery</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><span style="color: #004000;">start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">filterByUser</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><a href="http://www.php.net/end"><span style="color: #990000;">end</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
           <span style="color: #339933;">-&gt;</span><span style="color: #004000;">findOne</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'username'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'dte_created'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">format</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'U'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;</pre>

<pre class="php" style="font-family:monospace;"><span style="color: #000088;">$gateway</span> <span style="color: #339933;">=</span> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #000088;">$result</span> <span style="color: #339933;">=</span> <span style="color: #000088;">$gateway</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">selectQuery</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><span style="color: #004000;">start</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
                <span style="color: #339933;">-&gt;</span><span style="color: #004000;">filterByUser</span><span style="color: #009900;">&#40;</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">&#41;</span>
             <span style="color: #339933;">-&gt;</span><a href="http://www.php.net/end"><span style="color: #990000;">end</span></a><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span>
           <span style="color: #339933;">-&gt;</span><span style="color: #004000;">find</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
<span style="color: #b1b100;">if</span><span style="color: #009900;">&#40;</span><span style="color: #000088;">$result</span> <span style="color: #339933;">!==</span> <span style="color: #009900; font-weight: bold;">null</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'id'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'username'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">echo</span> <span style="color: #000088;">$result</span><span style="color: #009900;">&#91;</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000ff;">'dte_created'</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">-&gt;</span><span style="color: #004000;">format</span><span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'U'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
&nbsp;</pre>

<h2>Instance a Gateway?</h2>

<p>A Gateway has the following dependecies.</p>

<ol>
<li>The table name in the schema.</li>
<li>The <code>Doctrine\DBAL\Connection</code> $connection.</li>
<li>An instance of <code>Symfony\Component\EventDispatcher\EventDispatcherInterface</code>.</li>
<li>The meta data for table instance of <code>DBALGateway\Metadata\Table</code>.</li>
<li>(optional) a result-set to clone an instance class that implements <code>Doctrine\Common\Collections\Collection</code></li>
<li>(optional) a enity builder an instance class that implements <code>DBALGateway\Builder\BuilderInterface</code></li>
</ol>

<pre class="php" style="font-family:monospace;"> <span style="color: #000000; font-weight: bold;">new</span> MockUserGateway<span style="color: #009900;">&#40;</span><span style="color: #0000ff;">'users'</span><span style="color: #339933;">,</span><span style="color: #000088;">$conn</span><span style="color: #339933;">,</span><span style="color: #000088;">$event</span><span style="color: #339933;">,</span><span style="color: #000088;">$meta</span><span style="color: #339933;">,</span><span style="color: #000088;">$result_set</span><span style="color: #339933;">,</span><span style="color: #000088;">$builder</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
&nbsp;</pre>

<h2>Features and Events.</h2>

<p>The Gateway emits a number of events.</p>

<table>
 <tr>
  <th>
    Event Name
  </th>
  <th>
    Event Description
  </th>
 </tr>
 <tr>
  <td>
    pre_initilize   
  </td>
  <td>
    Occurs during object construction.
  </td>
 </tr>
  <tr>
  <td>
    post_initilize   
  </td>
  <td>
    Occurs after object construction.
  </td>
 </tr>
 <tr>
  <td>
    pre_select
  </td>
  <td>
    Occurs before a select query is run.
  </td>
 </tr>
 <tr>
  <td>
    post_select
  </td>
  <td>
    Occurs after a select query is run.
  </td>
 </tr>
 <tr>
  <td>
    pre_delete
  </td>
  <td>
    Occurs before delete query is run.
  </td>
 </tr>
 <tr>
  <td>
    post_delete
  </td>
  <td>
    Occurs after delete query is run.
  </td>
 </tr>
 <tr>
  <td>
    pre_insert
  </td>
  <td>
    Occurs before an insert is run.
  </td>
 </tr>
  <tr>
  <td>
    post_insert
  </td>
  <td>
    Occurs after an insert is run.
  </td>
 </tr>
  <tr>
  <td>
    pre_update
  </td>
  <td>
    Occurs before an update is run.
  </td>
 </tr>
  <tr>
  <td>
    post_update
  </td>
  <td>
    Occurs after an update is run.
  </td>
 </tr>  
</table>

<p>For an example see the <a href="http://github.com/icomefromthenet/DBALGateway/blob/master/src/DBALGateway/Feature/BufferedQueryLogger.php">BufferedQueryLogger</a>.</p>

	
		
            </div>
        </div>
        
	
	<div class='nav bottom'>
	    		<a href='/2012/11/05/doctrine_dbal_table_gateway.html'>Top</a>
	    	</div>
    </div>
    <div id="footer" class="footer">
        <div class='container'>
		    <p>
		Github: <a href="http://icomefromthenet.gtithub.com">http://icomefromthenet.gtithub.com </a>
	    </p>
	    <br style='clear: both;'>	
        	</div>
    </div>
</body>
</html>
